(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25057,e=>{"use strict";var s=e.i(93200),t=e.i(17927),a=e.i(20417),l=e.i(98319);function r(){let e=(0,a.useRouter)(),[r,o]=(0,l.useState)(""),[i,n]=(0,l.useState)(""),[c,d]=(0,l.useState)(""),[u,m]=(0,l.useState)([]),[b,x]=(0,l.useState)([]),[g,h]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(async()=>{let{data:e,error:s}=await t.supabase.from("categories").select("name").order("name",{ascending:!0});s&&console.error("Error fetching categories table:",s);let{data:a,error:l}=await t.supabase.from("posts").select("category");l&&console.error("Error fetching posts categories:",l),m(Array.from(new Set([...e?.map(e=>e.name)||[],...a?.map(e=>e.category).filter(Boolean)||[]])).sort().map((e,s)=>({id:`merged-${s}`,name:e,created_at:""})))})()},[]);let p=async e=>{if(!e.target.files||0===e.target.files.length)return;h(!0);let s=Array.from(e.target.files),a=[];try{for(let e of s){let s=e.name.split(".").pop(),l=`${Math.random()}.${s}`,r=`${l}`,{error:o}=await t.supabase.storage.from("post_images").upload(r,e);if(o)throw o;let{data:i}=t.supabase.storage.from("post_images").getPublicUrl(r);i&&a.push(i.publicUrl)}x(e=>[...e,...a])}catch(e){console.error("Image upload failed:",e),e instanceof Error?alert("이미지 업로드에 실패했습니다: "+e.message+" (Bucket 설정 확인 필요)"):alert("이미지 업로드에 실패했습니다. (Bucket 설정 확인 필요)")}finally{h(!1)}},f=async()=>{if(!c)return void alert("카테고리를 선택해주세요.");if(!r.trim())return void alert("제목을 입력해주세요.");let{error:s}=await t.supabase.from("posts").insert([{title:r,content:i,category:c,image_urls:b}]);s?alert("글 작성 오류: "+s.message):e.push("/board")};return(0,s.jsx)("main",{className:"mx-auto max-w-2xl pb-20 space-y-8",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-slate-100 mb-6",children:"글 작성"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"카테고리"}),(0,s.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-3 text-slate-100 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"",children:"카테고리 선택"}),u.map(e=>(0,s.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"제목"}),(0,s.jsx)("input",{className:"w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-3 text-slate-100 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 placeholder-slate-500",placeholder:"제목을 입력하세요",value:r,onChange:e=>o(e.target.value)})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"내용"}),(0,s.jsx)("textarea",{className:"w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-3 text-slate-100 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 placeholder-slate-500 min-h-75",placeholder:"공부한 내용을 자유롭게 작성하세요...",value:i,onChange:e=>n(e.target.value)})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"이미지 첨부"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("label",{className:"cursor-pointer rounded-md bg-slate-800 px-4 py-2 text-sm font-medium text-slate-300 hover:bg-slate-700 border border-slate-700 transition-colors",children:[(0,s.jsx)("span",{children:g?"업로드 중...":"이미지 선택"}),(0,s.jsx)("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:p,disabled:g})]}),(0,s.jsxs)("span",{className:"text-xs text-slate-500",children:[b.length,"개의 이미지가 업로드됨"]})]}),b.length>0&&(0,s.jsx)("div",{className:"mt-4 grid grid-cols-3 gap-4",children:b.map((e,t)=>(0,s.jsxs)("div",{className:"relative aspect-video overflow-hidden rounded-lg border border-slate-800 bg-slate-900",children:[(0,s.jsx)("img",{src:e,alt:`Preview ${t}`,className:"h-full w-full object-cover"}),(0,s.jsx)("button",{onClick:()=>x(b.filter((e,s)=>s!==t)),className:"absolute top-1 right-1 rounded-full bg-black/50 p-1 text-white hover:bg-red-500 transition-colors",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))})]}),(0,s.jsx)("button",{className:"w-full rounded-md bg-blue-600 py-4 text-base font-bold text-white shadow-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",onClick:f,disabled:g,children:g?"이미지 업로드 중...":"저장하기"})]})})}e.s(["default",()=>r])}]);