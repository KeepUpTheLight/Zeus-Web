module.exports=[65284,a=>{"use strict";var b=a.i(50586),c=a.i(78560),d=a.i(28973),e=a.i(92989);function f(){let a=(0,d.useRouter)(),[f,g]=(0,e.useState)(""),[h,i]=(0,e.useState)(""),[j,k]=(0,e.useState)(""),[l,m]=(0,e.useState)([]),[n,o]=(0,e.useState)([]),[p,q]=(0,e.useState)(!1);(0,e.useEffect)(()=>{(async()=>{let{data:a,error:b}=await c.supabase.from("categories").select("name").order("name",{ascending:!0});b&&console.error("Error fetching categories table:",b);let{data:d,error:e}=await c.supabase.from("posts").select("category");e&&console.error("Error fetching posts categories:",e),m(Array.from(new Set([...a?.map(a=>a.name)||[],...d?.map(a=>a.category).filter(Boolean)||[]])).sort().map((a,b)=>({id:`merged-${b}`,name:a,created_at:""})))})()},[]);let r=async a=>{if(!a.target.files||0===a.target.files.length)return;q(!0);let b=Array.from(a.target.files),d=[];try{for(let a of b){let b=a.name.split(".").pop(),e=`${Math.random()}.${b}`,f=`${e}`,{error:g}=await c.supabase.storage.from("post_images").upload(f,a);if(g)throw g;let{data:h}=c.supabase.storage.from("post_images").getPublicUrl(f);h&&d.push(h.publicUrl)}o(a=>[...a,...d])}catch(a){console.error("Image upload failed:",a),a instanceof Error?alert("이미지 업로드에 실패했습니다: "+a.message+" (Bucket 설정 확인 필요)"):alert("이미지 업로드에 실패했습니다. (Bucket 설정 확인 필요)")}finally{q(!1)}},s=async()=>{if(!j)return void alert("카테고리를 선택해주세요.");if(!f.trim())return void alert("제목을 입력해주세요.");let{error:b}=await c.supabase.from("posts").insert([{title:f,content:h,category:j,image_urls:n}]);b?alert("글 작성 오류: "+b.message):a.push("/board")};return(0,b.jsx)("main",{className:"mx-auto max-w-2xl pb-20 space-y-8",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-slate-100 mb-6",children:"글 작성"}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"카테고리"}),(0,b.jsxs)("select",{value:j,onChange:a=>k(a.target.value),className:"w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-3 text-slate-100 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[(0,b.jsx)("option",{value:"",children:"카테고리 선택"}),l.map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"제목"}),(0,b.jsx)("input",{className:"w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-3 text-slate-100 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 placeholder-slate-500",placeholder:"제목을 입력하세요",value:f,onChange:a=>g(a.target.value)})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"내용"}),(0,b.jsx)("textarea",{className:"w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-3 text-slate-100 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 placeholder-slate-500 min-h-75",placeholder:"공부한 내용을 자유롭게 작성하세요...",value:h,onChange:a=>i(a.target.value)})]}),(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"이미지 첨부"}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("label",{className:"cursor-pointer rounded-md bg-slate-800 px-4 py-2 text-sm font-medium text-slate-300 hover:bg-slate-700 border border-slate-700 transition-colors",children:[(0,b.jsx)("span",{children:p?"업로드 중...":"이미지 선택"}),(0,b.jsx)("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:r,disabled:p})]}),(0,b.jsxs)("span",{className:"text-xs text-slate-500",children:[n.length,"개의 이미지가 업로드됨"]})]}),n.length>0&&(0,b.jsx)("div",{className:"mt-4 grid grid-cols-3 gap-4",children:n.map((a,c)=>(0,b.jsxs)("div",{className:"relative aspect-video overflow-hidden rounded-lg border border-slate-800 bg-slate-900",children:[(0,b.jsx)("img",{src:a,alt:`Preview ${c}`,className:"h-full w-full object-cover"}),(0,b.jsx)("button",{onClick:()=>o(n.filter((a,b)=>b!==c)),className:"absolute top-1 right-1 rounded-full bg-black/50 p-1 text-white hover:bg-red-500 transition-colors",children:(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},c))})]}),(0,b.jsx)("button",{className:"w-full rounded-md bg-blue-600 py-4 text-base font-bold text-white shadow-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",onClick:s,disabled:p,children:p?"이미지 업로드 중...":"저장하기"})]})})}a.s(["default",()=>f])}];

//# sourceMappingURL=app_posts_create_page_tsx_dd4a084a._.js.map